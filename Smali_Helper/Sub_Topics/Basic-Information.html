[
{
"Heading":"Register Information",
"Explanation": "<h1><span style=\"font-family: georgia;\"><u><span style=\"color: red;\">Introduction</span></u>&nbsp;:-</span></h1><div><b><span style=\"font-family: georgia;\">In <span style=\"color: #f1c232;\">dalvik's bytecode</span>, registers are always 32 bits, and can hold any type of value. 2 registers are us(Long and Double).</span></b></div><div><b><span style=\"font-family: georgia;\"><br /></span></b></div><div style=\"text-align: left;\"><h1><span style=\"font-family: georgia;\"><u><span style=\"color: red;\">How method parameters are passed into a method</span></u>&nbsp;:-</span></h1></div><div><b><span style=\"color: red; font-family: georgia; font-size: x-large;\"><u><br /></u></span></b></div><div><div><b><span style=\"font-family: georgia;\">When a method is invoked, the parameters to the method are placed into the last n registers. If a method has 2 arguments, and 5 registers <i><span style=\"color: #e69138;\">(v0-v4)</span></i>, the arguments would be placed into the last 2 registers - <span style=\"color: #e69138;\">v3</span> and <span style=\"color: #e69138;\">v4</span>.</span></b></div><div><b><span style=\"font-family: georgia;\"><br /></span></b></div><div><b><span style=\"font-family: georgia;\">The first parameter to a non-static methods is always the object that the method is being invoked on (the this object)</span></b></div><div><b><span style=\"font-family: georgia;\"><br /></span></b></div><div><b><span style=\"font-family: georgia;\">For example, let's say you are writing a non-static method <i><span style=\"color: #e69138;\">LMyObject;-&gt;callMe(II)V</span></i>. This method has 2 integer parameters, but it also has an implicit <i><span style=\"color: #e69138;\">LMyObject;</span></i> parameter before both integer parameters, so there are a total of 3 arguments to the method.</span></b></div><div><b><span style=\"font-family: georgia;\"><br /></span></b></div><div><b><span style=\"font-family: georgia;\">Let's say you specify that there are 5 registers in the method <i><span style=\"color: #e69138;\">(v0-v4)</span></i>, with either the .registers 5 directive or the .locals 2 directive (i.e. 2 local registers + 3 parameter registers). When the method is invoked, the object that the method is being invoked on (i.e. the this reference) will be in <span style=\"color: #e69138;\">v2</span>, the first integer parameter will be in <span style=\"color: #e69138;\">v3</span>, and the second integer parameter will be in <span style=\"color: #e69138;\">v4</span>.</span></b></div><div><b><span style=\"font-family: georgia;\"><br /></span></b></div><div><b><span style=\"font-family: georgia;\">For <span style=\"color: #e06666;\">static methods</span> it's the same thing, except there isn't an implicit this argument.</span></b></div><div style=\"font-weight: bold;\"><span style=\"font-family: georgia;\"><br /></span></div><div style=\"font-weight: bold;\"><span style=\"font-family: georgia;\"><br /></span></div><div style=\"font-weight: bold;\"><span style=\"font-family: georgia;\"><br /></span></div><div style=\"font-weight: bold; text-align: left;\"><h1><span style=\"font-family: georgia;\"><u><span style=\"color: red;\">Long/Double values</span></u>&nbsp;:-</span></h1></div><div style=\"font-weight: bold;\"><span style=\"font-family: georgia;\"><br /></span></div><div><div><b><span style=\"font-family: georgia;\">As mentioned previously, long and double primitives (J and D respectively) are 64 bit values, and require 2 registers. This is important to keep in mind when you are referencing method arguments. For example, let's say you have a (non-static) method <i><span style=\"color: #e69138;\">LMyObject;-&gt;MyMethod(IJZ)V</span></i>. The parameters to the method are <span style=\"color: #e69138;\"><i>LMyObject;</i></span>, int, long, bool. So this method would require 5 registers for all of its parameters.</span></b></div><div><b><span style=\"font-family: georgia;\"><br /></span></b></div><div><b><span style=\"font-family: georgia;\">• <span style=\"color: #e69138;\">p0</span>&nbsp; &nbsp;=&gt;&nbsp; this</span></b></div><div><b><span style=\"font-family: georgia;\">• <span style=\"color: #e69138;\">p1</span>&nbsp; &nbsp;=&gt;&nbsp; &nbsp; &nbsp; I</span></b></div><div><b><span style=\"font-family: georgia;\">• <span style=\"color: #e69138;\">p2</span>, <span style=\"color: #e69138;\">p3</span>&nbsp; &nbsp;=&gt;&nbsp; &nbsp;J</span></b></div><div><b><span style=\"font-family: georgia;\">• <span style=\"color: #e69138;\">p4</span>&nbsp; &nbsp; &nbsp; &nbsp; =&gt;&nbsp; &nbsp;Z</span></b></div><div><b><span style=\"font-family: georgia;\"><br /></span></b></div><div><b><span style=\"font-family: georgia;\">Also, when you are invoking the method later on, you do have to specify both registers for any <span style=\"color: #e06666;\">double-wide</span> arguments in the register list for the <span style=\"color: #e06666;\">invoke-kind</span> instruction.</span></b></div><div><b><span style=\"font-family: georgia;\"><br /></span></b></div><div><b><span style=\"font-family: georgia;\"><br /></span></b></div><div><h1 style=\"text-align: left;\"><span style=\"font-family: georgia;\"><u><span style=\"color: red; font-size: x-large;\">Register Names</span></u>&nbsp;:-</span></h1><div><span style=\"font-family: georgia;\"><br /></span></div></div><div><b><span style=\"font-family: georgia;\"><br /></span></b></div><div><div style=\"text-align: left;\"><b><span style=\"font-family: georgia;\">There are two naming schemes for registers - the normal <span style=\"color: #e69138;\">v#</span> naming scheme and the <span style=\"color: #ffa400;\">p#</span> naming scheme for parameter registers. The first register in the <span style=\"color: #ffa400;\">p#</span> naming scheme is the first parameter register in the method. So let's go back to the previous example of a method with 3 arguments and 5 total registers. The following table shows the normal <span style=\"color: #ffa400;\">v#</span> name for each register, followed by the<span style=\"color: #ffa400;\"> p#</span> name for the parameter registers</span></b></div><div style=\"text-align: left;\"><b><span style=\"font-family: georgia;\"><br /></span></b></div><div style=\"text-align: left;\"><b><span style=\"font-family: georgia;\">• <span style=\"color: #ffa400;\">v0</span>&nbsp; The first local register</span></b></div><div style=\"text-align: left;\"><b><span style=\"font-family: georgia;\">• <span style=\"color: #ffa400;\">v1</span>&nbsp; The second local register</span></b></div><div style=\"text-align: left;\"><b><span style=\"font-family: georgia;\">• <span style=\"color: #ffa400;\">v2</span>&nbsp; <span style=\"color: #ffa400;\">p0</span> The first parameter register</span></b></div><div style=\"text-align: left;\"><b><span style=\"font-family: georgia;\">• <span style=\"color: #ffa400;\">v3</span>&nbsp; <span style=\"color: #ffa400;\">p1</span> The second parameter register</span></b></div><div style=\"text-align: left;\"><b><span style=\"font-family: georgia;\">• <span style=\"color: #ffa400;\">v4</span>&nbsp; <span style=\"color: #ffa400;\">p2</span> The third parameter register</span></b></div><div style=\"text-align: left;\"><b><span style=\"font-family: georgia;\"><br /></span></b></div><div style=\"text-align: left;\"><b><span style=\"font-family: georgia;\">You can reference parameter registers by either name - it makes no difference.</span></b></div><div style=\"text-align: left;\"><b><span style=\"font-family: georgia;\"><br /></span></b></div><div style=\"text-align: left;\"><b><span style=\"font-family: georgia;\">Motivation for introducing parameter registers:</span></b></div><div style=\"text-align: left;\"><b><span style=\"font-family: georgia;\"><br /></span></b></div><div style=\"text-align: left;\"><b><span style=\"font-family: georgia;\">The<span style=\"color: #ffa400;\"> p#</span> naming scheme was introduced as a practical matter, to solve a common annoyance when editing smali code.</span></b></div><div style=\"text-align: left;\"><b><span style=\"font-family: georgia;\"><br /></span></b></div><div style=\"text-align: left;\"><b><span style=\"font-family: georgia;\">Say you have an existing method with a number of parameters and you are adding some code to the method, and you discover that you need an extra register. You think \"<i><span style=\"color: #2b00fe;\">No big deal, I'll just increase the number of registers specified in the .registers directive!\"</span></i>.</span></b></div><div style=\"text-align: left;\"><b><span style=\"font-family: georgia;\"><br /></span></b></div><div style=\"text-align: left;\"><b><span style=\"font-family: georgia;\">Unfortunately, it isn't quite that easy. Keep in mind that the method parameters are stored in the last registers in the method. If you increase the number of registers - you change which registers the method arguments get put into. So you would have to change the .registers directive and renumber every parameter register.</span></b></div><div><b><span style=\"font-family: georgia;\"><br /></span></b></div><div><b><span style=\"font-family: georgia;\">But if the <span style=\"color: #ffa400;\">p#</span> naming scheme was used to reference parameter registers throughout the method, you can easily change the number of registers in the method, without having to worry about renumbering any existing registers.</span></b></div></div><div><b><span style=\"font-family: georgia;\"><br /></span></b></div><div><b><span style=\"font-family: georgia;\"><br /></span></b></div><div><h1><span style=\"font-family: georgia;\"><span style=\"font-size: x-large;\"><span style=\"color: red;\"><u>Specifying the number of registers in a method</u></span>&nbsp;</span>:-</span></h1><div><b><span style=\"font-family: georgia;\">There are two ways to specify how many registers are available in a method. the .registers directive specifies the total number of registers in the method, while the alternate .locals directive specifies the number of <u>non-parameter</u> registers in the method. The total number of registers would also include however many registers are needed to hold the method parameters.</span></b></div><div><br /></div></div><div><b><br /></b></div><div><b><br /></b></div><div><b><br /></b></div><div><b><br /></b></div><div><b><br /></b></div></div></div>"

     },
{
"Heading":"Smali Information",
"Explanation":"<h1><span style=\"font-family: georgia;\"><u><span style=\"color: red;\">Fields</span></u>&nbsp;:-</span></h1><div><span style=\"font-family: georgia;\"><br /></span></div><div><span style=\"font-family: georgia;\"><div><b><span style=\"color: red; font-size: large;\">F</span><span style=\"color: red;\">ields</span> are likewise always specified in verbose form that includes the type that contains the field, the name of the field, and the type of the field. Again, this is to allow the virtual machine to be able to find the correct field, as well as to perform static analysis on the <span style=\"color: #ea9999;\">bytecode</span>.</b></div><div><b><br /></b></div><div><b>They take the form of <i><span style=\"color: #e69138;\">Lpackage/name/ObjectName;-&gt;FieldName:Ljava/lang/String;</span></i></b></div><div><b><br /></b></div><div><b>This should be pretty self-explanatory - it is the package&nbsp; and object name, the field name and the type of the field respectively.</b></div><div style=\"font-weight: bold;\"><br /></div><span><!--more--></span><div style=\"font-weight: bold;\"><br /></div><div style=\"font-weight: bold;\"><h1><span style=\"font-family: georgia;\"><u><span style=\"color: red;\">Methods</span></u>&nbsp;:-</span></h1></div><div><span><div><b><span style=\"color: red;\">Methods&nbsp;</span></b><b>are always specified in a very verbose form that includes the type that contains the method, the method name, the types of the parameters and the return type. All this information is required for the virtual machine to be able to find the correct method, and to be able to perform static analysis on the </b><span style=\"color: #ea9999; font-weight: bold;\">bytecode</span><b> (for verification/optimization purposes)</b></div><div style=\"font-weight: bold;\"><br /></div><div style=\"font-weight: bold;\">They take the form of <i><span style=\"color: #e69138;\">Lpackage/name/ObjectName;-&gt;MethodName(III)Z</span></i></div><div style=\"font-weight: bold;\"><br /></div><div style=\"font-weight: bold;\">In this example, you should recognize <i><span style=\"color: #e69138;\">Lpackage/name/ObjectName;</span></i> as a type. <span style=\"color: #e06666;\">MethodName</span> is obviously the name of the method. <span style=\"color: #e69138;\"><i>(III)Z</i></span> is the method's signature. <i><span style=\"color: #e69138;\">III</span></i> are the parameters (in this case, 3 integers), and<span style=\"color: #e69138;\"><i> Z</i></span> is the return type <span style=\"color: #e06666;\">(bool)</span>.</div><div style=\"font-weight: bold;\"><br /></div><div style=\"font-weight: bold;\">The method parameters are listed one right after another, with no separators between them.</div><div style=\"font-weight: bold;\"><br /></div><div style=\"font-weight: bold;\">Here's a more complex example:</div><div style=\"font-weight: bold;\"><br /></div><div style=\"font-weight: bold;\"><span style=\"color: #e69138;\"><i>Lpackage/name/ObjectName;-&gt;MethodName(I[[IILjava/lang/String;[Ljava/lang/Object;)Ljava/lang/String</i></span>;</div><div style=\"font-weight: bold;\"><br /></div><div style=\"font-weight: bold;\">In java, this would&nbsp;</div><div style=\"font-weight: bold;\"><br /></div><div style=\"font-weight: bold;\"><i><span style=\"color: #e69138;\">String</span></i> <span style=\"color: #e06666;\">MethodName</span><i><span style=\"color: #e69138;\">(int, int[][], int, String, Object[])</span></i></div><div style=\"font-weight: bold;\"><i><span style=\"color: #e69138;\"><br /></span></i></div><div style=\"font-weight: bold;\"><i><span><!--more--></span><span style=\"color: #e69138;\"><br /></span></i></div></span></div><div><h1 style=\"font-weight: bold;\"><span style=\"font-family: georgia;\"><span style=\"color: red;\"><u>Types</u></span> :-</span></h1><div><span><div><span style=\"color: #e06666;\"><b>Dalvik's bytecode</b></span><b> has two major classes of types, primitive types and reference types. Reference types are objects and arrays, everything else is a primitive.</b></div><div style=\"font-weight: bold;\"><br /></div><div style=\"font-weight: bold;\">Primitives are represented by a single letter. I didn't come up with these abbreviations - they are what is actually stored in the dex file, in string form. They are specified in the dex-format.html document (<i><span style=\"color: #e69138;\">dalvik/docs/dex-format.html</span></i> in the <span style=\"color: #cc0000;\">AOSP</span> repository)</div><div style=\"font-weight: bold;\"><br /></div><div style=\"font-weight: bold;\">• <span style=\"color: #e69138;\">V</span> - Void - can only be used for return types</div><div style=\"font-weight: bold;\">• <span style=\"color: #e69138;\">Z</span> - Boolean</div><div style=\"font-weight: bold;\">• <span style=\"color: #e69138;\">B</span> - Byte</div><div style=\"font-weight: bold;\">• <span style=\"color: #e69138;\">S</span> - Short</div><div style=\"font-weight: bold;\">• <span style=\"color: #e69138;\">C</span> - Char</div><div style=\"font-weight: bold;\">• <span style=\"color: #e69138;\">I</span> - Integer</div><div style=\"font-weight: bold;\">• <span style=\"color: #e69138;\">J</span> - Long (64 bits)</div><div style=\"font-weight: bold;\">• <span style=\"color: #e69138;\">F</span> - Float</div><div style=\"font-weight: bold;\">• <span style=\"color: #e69138;\">D</span> - Double (64 bits)</div><div style=\"font-weight: bold;\"><br /></div><div style=\"font-weight: bold;\">Objects take the form of <i><span style=\"color: #e69138;\">Lpackage/name/ObjectName;</span></i> - where the leading L indicates that it is an object type, package/name/ is the package that the object is in, <span style=\"color: #e06666;\">ObjectName</span> is the name of the object, and ; denotes the end of the object name. This would be equivalent to <span style=\"color: #e06666;\">package.name.ObjectName</span> in java. Or for a more concrete example, <span style=\"color: #e69138;\"><i>Ljava/lang/String;</i></span> is equivalent to <i><span style=\"color: #e69138;\">java.lang.String</span></i></div><div style=\"font-weight: bold;\"><br /></div><div style=\"font-weight: bold;\">Arrays take the form [<span style=\"color: #e69138;\">I</span> - this would be an array of integers with a single dimension. i.e. <span style=\"color: #e06666;\">int[]</span> in Java. For arrays with multiple dimensions, you simply add more [ characters. <span style=\"color: #e69138;\">[[I = int[][]</span>, <span style=\"color: #e69138;\">[[[I = int[][][]</span>, etc. (Note: The maximum number of dimensions you can have is <span style=\"color: #3d85c6;\">255</span>).</div><div style=\"font-weight: bold;\"><br /></div><div style=\"font-weight: bold;\">You can also have arrays of objects, [<i><span style=\"color: #e69138;\">Ljava/lang/String;</span></i> would be an array of <span style=\"color: #ea9999;\">Strings</span>.</div></span></div><div><span style=\"font-family: georgia;\"><b><br /></b></span></div><div style=\"font-weight: bold;\"><span style=\"font-family: georgia;\"><br /></span></div></div></span></div>"

}
]
